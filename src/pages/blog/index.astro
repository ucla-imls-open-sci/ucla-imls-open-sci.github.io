---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { slugify } from '../../utils/slugs';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => {
    const dateA = a.data.date ? new Date(a.data.date).valueOf() : 0;
    const dateB = b.data.date ? new Date(b.data.date).valueOf() : 0;
    return dateB - dateA;
});
---

<Layout title="Blog" description="Updates and news from the Open Science for Librarians project.">
  <header class="masthead" style="background-image: url('/assets/img/background-image-blue.png'); background-size: cover; height: 40vh; min-height: 300px;">
    <div class="container h-100">
      <div class="row h-100 align-items-center justify-content-center text-center">
        <div class="col-lg-10 align-self-end">
          <h1 class="text-white font-weight-bold" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.6);">Project Updates</h1>
          <hr class="divider my-4" style="border-color: #ffd100; border-width: 3px; max-width: 50px;" />
        </div>
        <div class="col-lg-8 align-self-baseline">
          <p class="text-white-75 font-weight-light" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
            News, announcements, and progress reports.
          </p>
        </div>
      </div>
    </div>
  </header>

  <section class="page-section bg-light" id="blog">
    <div class="container">
      <div class="row">
        {sortedPosts.map(post => (
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 border-0 shadow-sm blog-card">
              <div class="card-body">
                <small class="text-muted text-uppercase mb-2 d-block">
                    {post.data.date ? new Date(post.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : ''}
                </small>
                <h4 class="card-title mb-3">
                    <a href={`/blog/${post.id}`} class="text-dark text-decoration-none stretched-link">
                        {post.data.title}
                    </a>
                </h4>
                <p class="card-text text-muted">
                    {post.data.description || "Read more about this update..."}
                </p>
              </div>
              <div class="card-footer bg-transparent border-top-0 pt-0 pb-4">
                <div class="d-flex align-items-center">
                    <div class="small">
                        By <span class="font-weight-bold text-primary">{post.data.author}</span>
                    </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
.blog-card {
    transition: transform 0.2s;
}
.blog-card:hover {
    transform: translateY(-5px);
}
</style>
