---
import { getCollection } from 'astro:content';
import { siteConfig } from '../site_config';
import siteTextData from '../data/sitetext.yml';

const t = (siteTextData as any)[siteConfig.locale];
const blog = t.blog;

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => {
    // Check if dates exist before comparing
    const dateA = a.data.date ? new Date(a.data.date).valueOf() : 0;
    const dateB = b.data.date ? new Date(b.data.date).valueOf() : 0;
    return dateB - dateA;
}).slice(0, 3); // Only show top 3
---
<section class="page-section" id={blog.section || "blog"}>
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h2 class="section-heading text-uppercase">{blog.title || "Recent Updates"}</h2>
                <h3 class="section-subheading text-muted">Latest news from the project.</h3>
            </div>
        </div>
        
        <div class="row">
            {sortedPosts.map(post => (
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm blog-card">
                        <div class="card-body">
                            <small class="text-muted text-uppercase mb-2 d-block">
                                {post.data.date ? new Date(post.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : ''}
                            </small>
                            <h4 class="card-title mb-3">
                                <a href={`/blog/${post.slug}`} class="text-dark text-decoration-none stretched-link">
                                    {post.data.title}
                                </a>
                            </h4>
                            <p class="card-text text-muted small">
                                {post.data.description ? post.data.description.substring(0, 100) + '...' : "Read more about this update..."}
                            </p>
                        </div>
                    </div>
                </div>
            ))}
        </div>

        <div class="row mt-4">
            <div class="col-lg-12 text-center">
                <a class="btn btn-primary btn-xl" href="/blog">View All Posts</a>
            </div>
        </div>
    </div>
</section>

<style>
.blog-card {
    transition: transform 0.2s;
}
.blog-card:hover {
    transform: translateY(-5px);
}
</style>
