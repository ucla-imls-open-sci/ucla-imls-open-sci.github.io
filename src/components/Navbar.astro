---
import { siteConfig } from '../site_config';
import navData from '../data/navigation.yml';

// Access the specific locale's nav data
// We assume structure matches: { [locale]: { nav: [] } }
const navLinks = (navData as any)[siteConfig.locale]?.nav || [];
---
<nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand js-scroll-trigger" href="/#">
      {siteConfig.logo ? (
        <img height={siteConfig.logo.height} src={siteConfig.logo.path} alt={siteConfig.title} />
      ) : (
        siteConfig.title
      )}
    </a>
    <button
      class="navbar-toggler navbar-toggler-right"
      type="button"
      data-toggle="collapse"
      data-target="#navbarResponsive"
      aria-controls="navbarResponsive"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      Menu<i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav text-uppercase ml-auto">
        {navLinks.map((link: any) => (
          <li class="nav-item">
            {link.url ? (
               <a class="nav-link js-scroll-trigger" href={link.url}>{link.title}</a>
            ) : link.section ? (
               <a class="nav-link js-scroll-trigger" href={`/#${link.section}`}>{link.title}</a>
            ) : (
               <a class="nav-link js-scroll-trigger" href="/#">{link.title}</a>
            )}
          </li>
        ))}
        <!-- Dark Mode Toggle -->
        <li class="nav-item d-flex align-items-center">
          <div class="theme-switch-wrapper ml-3">
            <label class="theme-switch" for="checkbox" style="margin-bottom: 0;">
              <input type="checkbox" id="checkbox" />
              <div class="slider round"></div>
            </label>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  function initToggle() {
    const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
    if (!toggleSwitch) return;

    // Sync toggle with current document state
    const currentTheme = document.documentElement.getAttribute('data-theme');
    if (currentTheme === 'dark') {
        (toggleSwitch as HTMLInputElement).checked = true;
    }

    // Handle clicks
    toggleSwitch.addEventListener('change', (e) => {
        const isChecked = (e.target as HTMLInputElement).checked;
        const newTheme = isChecked ? 'dark' : 'light';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });
  }

  // Run on load
  initToggle();

  // Run on Astro navigation
  document.addEventListener('astro:after-swap', initToggle);
</script>
